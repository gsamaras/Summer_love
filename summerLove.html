<!DOCTYPE html>
<html>
<head>
  <title>4 my Queen</title>
  <link href="img/heartFavicon.ico" rel="icon" type="image/x-icon" />
  <meta property="og:url" content="http://cgi.di.uoa.gr/~grad1459/summerLove.html" />
  <meta property="og:image" content="img/summerLoveThumbnail.jpg" />
  <meta property="og:title" content="4 my Queen" />
  <meta property="og:description" content="Provide initials of the couple and share the link with your loved one!" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <link rel="stylesheet" type="text/css" href="wave.css">
</head>

<body>

<div class="container">

<div class="sonar-wrapper">
  <div class="sonar-emitter" onclick="clearWaves()">
    <span id="tapTxt" class="absl"></span>
    <div id="sonarWave" class="sonar-wave"></div>
  </div>
  <img src="https://sdl-stickershop.line.naver.jp/products/0/0/1/1034784/android/stickers/1469060.png;compress=true"
 alt="sooperIdea" height="72" width="72" class="sooperIdea hide" id="sooperIdea">
</div>


<div class="text" id="sandWriting"><span id="loveTxt" class="loveTxt">&Gamma; + &Mu;</span><span id="heart" class="loveTxt"> = &#x2661;</span></div>

<div id="oceanDiv" class="ocean">
  <div id="wave1" class="wave"></div>
  <div id="wave2" class="wave"></div>
</div>

</div>

<div class="container">
  <button id="startBtn" type="button" class="btn btn-info btn-lg centerBtn" data-toggle="modal" data-target="#myModal">Start</button>

  <div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Initials of the couple.</h4>
        </div>
        <div class="modal-body">
  	  <form>
            <div id="form2div" class="form-group">
              <label for="hers">Hers name's initial letter:</label>
              <input type="text" class="form-control" id="hers" maxlength="1">
            </div>
            <div id="form1div" class="form-group">
              <label for="his">His name's initial letter:</label>
              <input type="text" class="form-control" id="his" maxlength="1">
            </div>
  	  </form>
        </div>
        <div class="modal-footer">
          <button id="okBtn" type="button" class="btn btn-primary" disabled="disabled">Okay</button>
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
      
    </div>
  </div>
  
</div>

</body>

<script>

var sunTapped_global = 0;
var timer_global;

function clearWaves() {
  clearTimeout(timer_global);
  document.getElementById("tapTxt").innerHTML="";
  document.getElementById("wave1").style.opacity = 0;
  document.getElementById("wave2").style.opacity = 0;
  document.getElementById("oceanDiv").style.opacity = 0;
  document.getElementById("sonarWave").classList.remove("sonar-wave");
  document.getElementById("sooperIdea").classList.remove("hide");
  setTimeout(hideSooperIdea, 4000);
  document.getElementById("sandWriting").style.opacity = 1;
  document.getElementById("loveTxt").style.opacity = 1;
  document.getElementById("heart").style.opacity = 1;
  sunTapped_global = 1;
}

function moveOcean() {
  document.getElementById("oceanDiv").style.bottom = "90px";
  document.getElementById("oceanDiv").style.height = "10%";
}

function hideSooperIdea() {
  document.getElementById("sooperIdea").style.opacity=0;
}

function isLetter(str) {
  return str.length === 1 && str.match(/[a-z]/i);
}

var greek = ["\u03B1", "\u03B2", "\u03B3", "\u03B4", "\u03B5", "\u03B6", "\u03B7", "\u03B8",
"\u03B9", "\u03BA", "\u03BB", "\u03BC", "\u03BD", "\u03BE", "\u03BF", "\u03C0", "\u03C1",
"\u03C3", "\u03C4", "\u03C5", "\u03C6", "\u03C7", "\u03C8", "\u03C9"
];

window.onload = function() {
  var url = window.location.href;
  // http://cgi.di.uoa.gr/~grad1459/summerM.html?a+a
//alert(url);
  var i = url.indexOf("?");
  if(i >= 0)
  {
    document.getElementById("startBtn").style.opacity = 0;
    var first_part = url[i + 1];
    if(url[i + 2] != '+')
      first_part += url[i + 2];
    var plus_sign_i = url.indexOf("+");
    var second_part = url[plus_sign_i + 1];
    if(plus_sign_i + 2 != url.length)
      second_part += url[plus_sign_i + 2];
    var first_letter = (isLetter(first_part)) ? first_part : greek[first_part];
    var second_letter = (isLetter(second_part)) ? second_part : greek[second_part];
    document.getElementById("loveTxt").innerHTML = first_letter + " + " + second_letter; 
    if(!sunTapped_global)
      timer_global = setTimeout(writeTap, 4000);
  }
  else
  {
    document.getElementById("startBtn").focus();
    document.getElementById("sonarWave").classList.remove("sonar-wave");
    //document.getElementById("sonarWave").classList += "sonar-wave";
  }
};

function writeTap() {
  document.getElementById("tapTxt").innerHTML="Tap";
}

$("#okBtn").on("click touchstart", function(){
    $("#form1div").hide();
    $(".modal-title").text("Share this link with your loved one!");
    $('label[for="hers"]').text("");
//if( greek.indexOf($("#hers").val().toLowerCase()) >= 0 )alert($("#hers").val() + " " + greek.indexOf($("#hers").val().toLowerCase()))
    var hers_val = $("#hers").val();
    var hers_i = greek.indexOf(hers_val.toLowerCase());
    var hers_char = (hers_i == -1) ? hers_val : hers_i;
    var his_val = $("#his").val();
    var his_i = greek.indexOf(his_val.toLowerCase());
    var his_char = ( his_i == -1 ) ? his_val : his_i; 
    $("#hers").val(function () {return "http://cgi.di.uoa.gr/~grad1459/summerM.html?" + hers_char + "+" + his_char;})
    document.getElementById('hers').readOnly = true;
    document.getElementById('hers').disabled = true;
    document.getElementById('hers').style.cursor = "copy";
    $(this).hide();
});

$(document).ready(function(){
    $('form > div > input').keyup(function() {
        var empty = false;
        $('form > div > input').each(function() {
            if ($(this).val() == '') {
                empty = true;
            }
        });
        if (empty) {
            $('#okBtn').attr('disabled', 'disabled');
        } else {
            $('#okBtn').removeAttr('disabled');
        }
    });

    $('#hers').bind('keyup blur',function(){ 
      var node = $(this);
      node.val(node.val().replace(/[^A-ZA-zΑ-Ωα-ωίϊΐόάέύϋΰήώ]/g,'') ); }
    );
    $('#his').bind('keyup blur',function(){
      var node = $(this);
      node.val(node.val().replace(/[^A-ZA-zΑ-Ωα-ωίϊΐόάέύϋΰήώ]/g,'') ); }
    );
});  

</script>
</html>
